<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moisture Farmer v0.98 - Phaser.js w/ Windows 98 Styling</title>
    <link rel="stylesheet" href="98.css/98.css">
    <link rel="stylesheet" href="98.css/draggable.css">
    <link rel="stylesheet" href="app.css">
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser-arcade-physics.min.js"></script>
    <script src="98.css/draggable.js" defer></script>
    <!-- Core modules -->
    <script src="core.js" defer></script>
    <script src="animation.js" defer></script>
    <script src="sse.js" defer></script>
    <script src="simulation-display.js" defer></script>
    <script src="droid-chat.js" defer></script>
    <script src="entity-detail.js" defer></script>
    <script src="simulation-controls.js" defer></script>
    <script src="world-rendering.js" defer></script>
    <script src="window-management.js" defer></script>
    <!-- Main application script -->
    <script src="app.js" defer></script>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
</head>
<body id="desktop">
  <!-- NEW: Full-viewport world layer -->
  <div id="world-layer">
    <canvas id="world-canvas"></canvas>
    <div id="world-entities"></div>
  </div>
  
  <div id="droid-window" class="window draggable resizeable" style="width: 240px; height: 300px;">
    <div class="title-bar">
      <div class="title-bar-text">
        R5-D5
      </div>
      <div class="title-bar-controls">
        <button aria-label="Help"></button>
        <button aria-label="Close"></button>
      </div>
    </div>
    <div class="window-body">
      <ul>
        <li>Battery Level: 40 / 100</li>
      </ul>
    </div>
    <div class="status-bar">
      <p class="status-bar-field">Battery Level:</p>
      <p class="status-bar-field">
          40 / 100
      </p>
    </div>
  </div>

  <div id="simulation-detail-window" class="window draggable resizeable hidden" style="right:640px; top: 200px; width: 300px; height: 300px;">
    <div class="title-bar">
      <div class="title-bar-text">
        Simulation Detail View
      </div>
      <div class="title-bar-controls">
        <button aria-label="Help"></button>
        <button aria-label="Close"></button>
      </div>
    </div>
    <div class="window-body">
      <div id="simulation-detail-window-body-entities" style="height: 100%; width:100%;">
        <ul>
          <!-- Entities will be dynamically populated here -->
        </ul>
      </div>
    </div>
  </div>
  <div id="simulation-control-window" class="window no-select draggable" style="position: absolute; width: 640px; top: 20px; left: 50%;">
    <div class="title-bar">
      <div class="title-bar-text">
        Moisture Farmer v0.98
      </div>
      <div class="title-bar-controls">
        <button aria-label="Help" onclick="navigateTo('http://github.com/HanClinto/MoistureFarmer')"></button>
        <button class="hidden" aria-label="Restore" onclick="doFullscreen(false)"></button>
        <button aria-label="Maximize" onclick="doFullscreen(true)"></button>
      </div>
    </div>
    <div class="menu-bar">
      <div class="menu-bar-item">
        <button aria-label="File"><u>F</u>ile</button>
        <ul class="menu">
          <li onmousedown="createNewScenario()"><u>N</u>ew</li>
          <li onmousedown="openScenarioFile()"><u>O</u>pen...</li>
          <li onmousedown="saveScenarioFile()"><u>S</u>ave</li>
          <li class="divider"></li>
          <li class="disabled">Page Se<u>t</u>up...</li>
          <li onmousedown="print()"><u>P</u>rint</li>
          <li class="divider"></li>
          <li onmousedown="navigateTo('http://starwars.com/')">E<u>x</u>it</li>
        </ul>
      </div>
      <div class="menu-bar-item">
        <button aria-label="Edit"><u>E</u>dit</button>
        <ul class="menu">
          <li class="disabled"><u>U</u>ndo<span>Ctrl+Z</span></li>
          <li class="divider"></li>
          <li class="disabled"><u>C</u>ut<span>Ctrl+X</span></li>
          <li class="disabled"><u>C</u>opy<span>Ctrl+C</span></li>
          <li class="disabled"><u>P</u>aste<span>Ctrl+V</span></li>
          <li class="disabled">De<u>l</u>ete<span>Del</span></li>
          <li class="divider"></li>
          <li>Select <u>A</u>ll</li>
          <li>Time/<u>D</u>ate<span>F5</span></li>
          <li class="divider"></li>
          <li><u>W</u>ord Wrap</li>
          <li>Set <u>F</u>ont...</li>
        </ul>
      </div>
      <div class="menu-bar-item">
        <button aria-label="Entities"><u>E</u>ntities</button>
        <ul class="menu">
          <li onmousedown="showEntityDetailWindow('GX1_Vaporator_1')"><img src="/resources/sprites/GX-1.png"><span>GX1_Vaporator_1</span></li>
          <li onmousedown="showEntityDetailWindow('GonkDroid_1')"><img src="/resources/sprites/EG-6.png"><span>GonkDroid_1</span></li>
        </ul>
      </div>
      <div class="menu-bar-item">
        <button aria-label="Help"><u>H</u>elp</button>
        <ul class="menu">
          <li><u>H</u>elp Topics</li>
          <li class="divider"></li>
          <li><u>A</u>bout MoistureFarmer95</li>
        </ul>
      </div>
    </div>
    <div class="window-body">
      <button id="open-simulation-detail-view" onclick="showWindow('simulation-detail-window')">Open Simulation Detail View</button>
    </div>
    <div class="status-bar">
      <p class="status-bar-field">Simulation Status:</p>
      <p id="simulation-status-paused" class="status-bar-field">
          -
      </p>
      <p class="status-bar-field">
          <button id="simulation-pause" onclick="toggleSimulationPaused()">Pause</button>
      </p>
      <p class="status-bar-field">
          <button id="simulation-delay-2" class="simulation-delay-button active" onclick="setSimulationDelay(2)">1x</button>
          <button id="simulation-delay-0.5" class="simulation-delay-button" onclick="setSimulationDelay(0.5)">4x</button>
          <button id="simulation-delay-0.2" class="simulation-delay-button" onclick="setSimulationDelay(0.2)">10x</button>
      </p>
      <p id="simulation-tick-count-label" class="status-bar-field">
          Tick:
      </p>
      <p id="simulation-tick-count" class="status-bar-field">
          #
      </p>
    </div>
  </div>
</body>

<script>
// Initialize draggable & optional centering for simulation-control-window
window.addEventListener('DOMContentLoaded', function() {
  const win = document.getElementById('simulation-control-window');
  if (win) {
    // Center horizontally once, then convert percentage left to pixel value for smooth dragging
    const rect = win.getBoundingClientRect();
    const desiredLeft = (window.innerWidth - rect.width) / 2;
    win.style.left = desiredLeft + 'px';
    // Remove any transform if present (was used for centering before)
    win.style.transform = '';
    // Hook existing utilities if defined
    if (typeof draggableElement === 'function') draggableElement(win);
    if (typeof bringableToFront === 'function') bringableToFront(win);
  }
});
</script>

</html>